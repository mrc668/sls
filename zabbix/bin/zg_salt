#!/bin/bash
# source salt://pillars/zabbix/zg_salt

/usr/bin/systemctl status salt-minion | grep active..running -q || { echo 1; exit 1; }

# Don't do this... it times out.
#/usr/bin/salt-call test.ping | grep True -q || { echo 2; exit 2; }

grep "Data failed to compile" /var/log/salt-call* -q && { echo 3; exit 3; }
grep "Result: False"  /var/log/salt-call* -q && { echo 4; exit 4; }

# file exists and has size greater than 0
[ -s /var/log/salt-call.log ] || { echo 5; exit 5; }

# file should be less than 10 minutes since last update.
[ $(( $(date +%s) - $(stat -c +%Y /var/log/salt-call.log) )) -lt 600 ] || { echo 6; exit 6; }

echo 0; exit

